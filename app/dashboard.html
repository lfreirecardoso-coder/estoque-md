<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estoque | Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

  <!-- Tema Dark + correções -->
  <link rel="stylesheet" href="theme.css" />
</head>
<body class="app-body">

  <!-- NAV / TOPO (sempre visível) -->
  <nav class="navbar navbar-dark bg-transparent px-2 px-md-3 border-bottom border-dark-subtle sticky-top">
    <div class="container-fluid">
      <!-- Botão abre sidebar como offcanvas no mobile -->
      <button class="btn btn-outline-light d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar" aria-label="Abrir menu">
        ☰
      </button>
      <span class="navbar-brand ms-2">Estoque -MD-</span>

      <div class="d-flex gap-2">
        <a href="rel.html" class="btn btn-ghost d-none d-sm-inline">Relatórios</a>
        <button id="btnLogoutTop" class="btn btn-outline-danger">Sair</button>
      </div>
    </div>
  </nav>

  <!-- SIDEBAR DESKTOP (fixa) -->
  <aside id="sidebarDesktop" class="sidebar d-none d-lg-flex flex-column">
    <div class="p-3">
      <div class="d-flex align-items-center gap-2 mb-3">
        <img src="logo.png" alt="" class="brand-logo">
        <strong class="brand-title">Estoque -MD-</strong>
      </div>

      <nav class="nav flex-column gap-1">
        <a class="nav-link" href="dashboard.html"><span>Gestão de Estoque</span></a>
        <a class="nav-link" href="novo.html"><span>Cadastro de Estoque</span></a>
        <a class="nav-link" href="cadastro_base.html"><span>Cadastro Base</span></a>
        <a class="nav-link" href="rel.html"><span>Relatórios</span></a>
        <a class="nav-link" href="admin_users.html"><span>Cadastro de Usuários</span></a>
        <a class="nav-link" href="mov.html"><span>Log de Movimentações</span></a>
      </nav>

      <hr class="my-3 border-dark-subtle">

      <div class="d-grid">
        <button id="btnCollapse" class="btn btn-ghost">↔ Colapsar</button>
        <button id="btnLogoutSide" class="btn btn-outline-danger mt-2">Sair</button>
      </div>
    </div>
  </aside>

  <!-- SIDEBAR MOBILE (offcanvas) -->
  <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
    <div class="offcanvas-header border-bottom border-dark-subtle">
      <h5 class="offcanvas-title" id="offcanvasSidebarLabel">Menu</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
    </div>
    <div class="offcanvas-body">
      <nav class="nav flex-column gap-2">
        <a class="nav-link" href="dashboard.html">Gestão de Estoque</a>
        <a class="nav-link" href="novo.html">Cadastro de Estoque</a>
        <a class="nav-link" href="cadastro_base.html">Cadastro Base</a>
        <a class="nav-link" href="rel.html">Relatórios</a>
        <a class="nav-link" href="admin_users.html">Cadastro de Usuários</a>
        <a class="nav-link" href="mov.html">Log de Movimentações</a>
      </nav>
      <hr class="my-3 border-dark-subtle">
      <button id="btnLogoutOffcanvas" class="btn btn-outline-danger w-100">Sair</button>
    </div>
  </div>

  <!-- CONTEÚDO -->
  <main class="content container-fluid py-3">
    <header class="mb-3">
      <h2 class="page-title mb-1">Estoque | Dashboard</h2>
      <p class="text-muted">Filtre, exporte e movimente itens do estoque. Clique na imagem para pré-visualizar.</p>
    </header>

    <!-- FILTROS -->
    <section class="card p-3 mb-4">
      <div class="row g-3">
        <div class="col-12 col-md-4">
          <label for="fNome" class="form-label">Filtrar por nome</label>
          <input id="fNome" class="form-control" placeholder="Ex.: Fio, Tomada, Cabo...">
        </div>
        <div class="col-12 col-md-4">
          <label for="fCategoria" class="form-label">Categoria</label>
          <input id="fCategoria" class="form-control" placeholder="Ex.: Elétrica, Som...">
        </div>
        <div class="col-12 col-md-4">
          <label for="fLocal" class="form-label">Local de Armazenamento</label>
          <input id="fLocal" class="form-control" placeholder="Ex.: Caixa A1, Depósito...">
        </div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button type="button" class="btn btn-ghost" id="btnCsv">Exportar CSV</button>
        <button type="button" class="btn btn-ghost" id="btnPdf">Exportar PDF</button>
      </div>
    </section>

    <!-- TABELA -->
    <section class="table-wrap p-2">
      <div class="table-responsive">
        <table id="tblItens" class="table table-hover align-middle">
          <thead>
            <tr>
              <th>Imagem</th>
              <th>Nome</th>
              <th>Categoria</th>
              <th>Qtd</th>
              <th>Unid.</th>
              <th>Local</th>
              <th class="text-end">Ações</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- MODAL: imagem -->
  <div class="modal fade" id="modalImg" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content modal-card">
        <div class="modal-header">
          <h5 class="modal-title">Imagem do item</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <img id="bigImg" src="" alt="Imagem do item" class="w-100 rounded-3 border" />
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle (JS dos componentes) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <!-- Firebase + sua lógica -->
  <script src="firebase.js"></script>

  <!-- Sidebar & comportamento responsivo -->
  <script>
  (function(){
    const body = document.body;
    // Previna scroll horizontal fantasma
    body.style.overflowX = 'hidden';

    // Colapsar sidebar desktop
    const sidebar = document.getElementById('sidebarDesktop');
    const btnCollapse = document.getElementById('btnCollapse');
    btnCollapse?.addEventListener('click', () => {
      sidebar.classList.toggle('sidebar-collapsed');
    });

    // Logout em todos os lugares
    const logout = () => { window.auth?.signOut?.(); location.href = 'login.html'; };
    document.getElementById('btnLogoutTop')?.addEventListener('click', logout);
    document.getElementById('btnLogoutSide')?.addEventListener('click', logout);
    document.getElementById('btnLogoutOffcanvas')?.addEventListener('click', logout);
  })();
  </script>

  <!-- SUA LÓGICA DO DASHBOARD (render/listeners) -->
  <script src="dashboard.js"></script>
</body>
</html>
